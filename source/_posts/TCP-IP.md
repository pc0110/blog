---
title: TCP/IP
date: 2019-10-17 14:30:44
<<<<<<< HEAD
tags:TCP/IP
---

# TCP/IP

**TCP是一种面向连接的可靠的字节流服务，**面向连接就意味着在相互通讯之间必须要建立链接

TCP/IP是可靠的：

- 应用数据被TCP分为合适的数据块
- TCP发送一个报文之后会有一个定时器，等待目的点确认，否则会一直发送报文
- 当TCP收到连接端发送的数据会推迟**千分之一秒**发送确认信息
- TCP是以IP报文来发送，发送的时候是无序的，TCP接受到所有的数据之后进行排序，之后交给应用层

##  TCP建立三次连接的过程（三次握手）

TCP是一个面向连接的协议，无论哪一方向另一方发送数据之前，都必须先在双方之间建立一条连接，建立一条连接有以下过程。
1、请求端（客户端）发送一个SYN段指明客户打算连接的服务器的端口，以及初始序列号（ISN），这个SYN为报文段1.
2、服务器发回包含服务器的初始序列号的SYN报文段（报文段2）作为应答。同时，将确认序号设置为客户的ISN加1以对客户的SYN报文段进行确认。一个SYN将占用一个字符。
3、客户必须将明确序号设置为服务器的ISN加1以对服务器的SYN报文段进行确认（报文段3）
4、这三个报文段完成连接的建立，这个过程成为三次握手

![](E:\blog\source\_posts\images\三次握手.png)

## TCP终止连接过程（四次挥手）
1、客户端进程发出连接释放报文，并且停止发送数据。释放数据报文首部，FIN=1，其序列号为seq=u（等于前面已经传送过来的数据的最后一个字节的序号加1），此时，客户端进入FIN-WAIT-1（终止等待1）状态。 TCP规定，FIN报文段即使不携带数据，也要消耗一个序号。
2、服务器收到连接释放报文，发出确认报文，ACK=1，ack=u+1，并且带上自己的序列号seq=v，此时，服务端就进入了CLOSE-WAIT（关闭等待）状态。TCP服务器通知高层的应用进程，客户端向服务器的方向就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受。这个状态还要持续一段时间，也就是整个CLOSE-WAIT状态持续的时间。
客户端收到服务器的确认请求后，此时，客户端就进入FIN-WAIT-2（终止等待2）状态，等待服务器发送连接释放报文（在这之前还需要接受服务器发送的最后的数据）。
3、服务器将最后的数据发送完毕后，就向客户端发送连接释放报文，FIN=1，ack=u+1，由于在半关闭状态，服务器很可能又发送了一些数据，假定此时的序列号为seq=w，此时，服务器就进入了LAST-ACK（最后确认）状态，等待客户端的确认。
客户端收到服务器的连接释放报文后，必须发出确认，ACK=1，ack=w+1，而自己的序列号是seq=u+1，此时，客户端就进入了TIME-WAIT（时间等待）状态。注意此时TCP连接还没有释放，必须经过2∗MSL（最长报文段寿命）的时间后，当客户端撤销相应的TCB后，才进入CLOSED状态。
4、服务器只要收到了客户端发出的确认，立即进入CLOSED状态。同样，撤销TCB后，就结束了这次的TCP连接。可以看到，服务器结束TCP连接的时间要比客户端早一些。

![](E:\blog\source\_posts\images\四次握手.png)
=======
tags:
---
>>>>>>> e38011719beca8f9c3c9ce58b48689d26f37629e
